<div *ngIf="form" class="container new-user">
    <form [formGroup]="form" class="form" (ngSubmit)="form.valid && submit()" novalidate>
        <div class="form-group">
            <label for="name">Username</label>
            <input type="text" class="form-control" id="username" formControlName="username" 
                   required [readonly]="isEdit" />
            <div *ngIf="username.invalid && (username.dirty || username.touched)" class="alert-sm alert-danger">
                Username is required
            </div>
        </div>
        <div class="form-group">
            <label for="password">Password</label>
            <input type="password" class="form-control" id="password" formControlName="password" 
                   [required]="!isEdit" />
            <div *ngIf="password.invalid && (password.dirty || password.touched)" class="alert-sm alert-danger">
                Password is required
            </div>
        </div>
        <div class="form-group">
            <label for="password-confirmation">Confirm password</label>
            <input type="password" class="form-control" id="password-confirmation" 
                   formControlName="passwordConfirmation" [required]="!isEdit" />
            <div *ngIf="passwordConfirmation.invalid && (passwordConfirmation.dirty || passwordConfirmation.touched)" class="alert-sm alert-danger">
                Password confirmation is required
            </div>
        </div>
        <div class="row alert-sm alert-danger" *ngIf="form.errors">{{ form.errors?.passwords | json }}</div>

        <div class="form-group">
            <label for="firstname">First name</label>
            <input type="text" class="form-control" id="firstname" formControlName="firstname" />
        </div>
        <div class="form-group">
            <label for="lastname">Last name</label>
            <input type="text" class="form-control" id="lastname" formControlName="lastname" />
        </div>
        <div class="form-group">
            <label for="status">Status</label>
            <input type="text" class="form-control" id="status" formControlName="status" />
        </div>
        <label>Permissions</label>
        <div formArrayName="permissions">
            <div class="form-check" *ngFor="let permission of permissions; let i = index">
                <label class="form-check-label" formGroupName="{{i}}">
                    <input type="checkbox" formControlName="{{permission.id}}" class="form-check-input"
                           (change)="onChange(permission, $event.target.checked)">
                    {{permission.resourceKey}}
                </label>
            </div>
        </div>
        
        <button type="submit" class="btn btn-info" [disabled]="form.invalid">
            Submit
        </button>
        <a class="btn btn-secondary" routerLink="/usermanagement">
            Cancel
        </a>
    </form>
</div>